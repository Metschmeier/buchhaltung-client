<h2>Alle Buchungen</h2>
<button (click)="exportCsv()">üì• Als CSV exportieren</button>
<ul>
  @for (b of buchungen(); track b.id) {
    <li>
      {{ b.datum | date }} - {{ b.beschreibung }} - {{ b.betragNetto | currency }}
      <button (click)="editBuchung(b)">Bearbeiten</button>
      <button (click)="deleteBuchung(b.id)" [disabled]="b.locked">L√∂schen</button>
    </li>
  }
</ul>

<h2>Nur Eink√§ufe</h2>
<ul>
  @for (e of einkaeufe(); track e.id) {
    <li>
      {{ e.datum | date }} - {{ e.beschreibung }} - {{ e.betragNetto | currency }}
    </li>
  }
</ul>

<hr />

<h3>{{ form.value.id === 0 ? 'Neue Buchung' : 'Buchung bearbeiten' }}</h3>

<form [formGroup]="form" (ngSubmit)="saveBuchung()">

  <label>
    Datum:
    <input type="date" formControlName="datum" />
    @if (form.controls.datum.invalid && form.controls.datum.touched) {
      <span>Datum ist erforderlich.</span>
    }
  </label><br />

  <label>
    Typ:
    <input formControlName="typ" />
    @if (form.controls.typ.invalid && form.controls.typ.touched) {
      <span>Typ ist erforderlich.</span>
    }
  </label><br />

  <label>
    Beschreibung:
    <input formControlName="beschreibung" />
    @if (form.controls.beschreibung.invalid && form.controls.beschreibung.touched) {
      <span>Beschreibung ist erforderlich.</span>
    }
  </label><br />

  <label>
    Betrag netto:
    <input type="number" formControlName="betragNetto" step="0.01" />
    @if (form.controls.betragNetto.invalid && form.controls.betragNetto.touched) {
      <span>Bitte einen positiven Betrag eingeben.</span>
    }
  </label><br />

  <label>
    Partner:
    <select formControlName="partnerId">
      <option value="">Bitte w√§hlen</option>
      @for (p of partners(); track p.id) {
        <option [value]="p.id">{{ p.name }}</option>
      }
    </select>
    @if (form.controls.partnerId.invalid && form.controls.partnerId.touched) {
      <span>Partner ist erforderlich.</span>
    }
  </label><br />

  <label>
    Kategorie:
    <select formControlName="kategorieId">
      <option value="">Bitte w√§hlen</option>
      @for (k of kategorien(); track k.id) {
        <option [value]="k.id">{{ k.kategorie }}</option>
      }
    </select>
    @if (form.controls.kategorieId.invalid && form.controls.kategorieId.touched) {
      <span>Kategorie ist erforderlich.</span>
    }
  </label><br />

  <label>
    Kostenstelle:
    <select formControlName="kostenstelleId">
      <option value="">Bitte w√§hlen</option>
      @for (ks of kostenstellen(); track ks.id) {
        <option [value]="ks.id">{{ ks.kostenstelle }}</option>
      }
    </select>
    @if (form.controls.kostenstelleId.invalid && form.controls.kostenstelleId.touched) {
      <span>Kostenstelle ist erforderlich.</span>
    }
  </label><br />

  <label>
    Steuersatz:
    <select formControlName="steuersatzId">
      <option value="">Bitte w√§hlen</option>
      @for (st of steuersaetze(); track st.id) {
        <option [value]="st.id">{{ st.bezeichnung }} ({{ st.prozentsatz }}%)</option>
      }
    </select>
    @if (form.controls.steuersatzId.invalid && form.controls.steuersatzId.touched) {
      <span>Steuersatz ist erforderlich.</span>
    }
  </label><br />

  <label>
    Gesperrt:
    <input type="checkbox" [checked]="form.value.locked" disabled />
  </label><br />

  <button type="submit" [disabled]="form.invalid || form.value.locked">Speichern</button>
  <button type="button" (click)="form.reset()">Abbrechen</button>

</form>