<h2>Alle Buchungen</h2>
<ul>
  @for (b of buchungen(); track b.id) {
    <li>
      {{ b.datum | date }} - {{ b.beschreibung }} - {{ b.betragnetto | currency }}
      <button (click)="editBuchung(b)">Bearbeiten</button>
      <button (click)="deleteBuchung(b.id)" [disabled]="b.locked">Löschen</button>
    </li>
  }
</ul>

<h2>Nur Einkäufe</h2>
<ul>
  @for (e of einkaeufe(); track e.id) {
    <li>
      {{ e.datum | date }} - {{ e.beschreibung }} - {{ e.betragnetto | currency }}
    </li>
  }
</ul>

<hr />

<h3>{{ form.value.id === 0 ? 'Neue Buchung' : 'Buchung bearbeiten' }}</h3>

<form [formGroup]="form" (ngSubmit)="saveBuchung()">

  <label>
    Datum:
    <input type="date" formControlName="datum" />
    @if (form.controls.datum.invalid && form.controls.datum.touched) {
      <span>Datum ist erforderlich.</span>
    }
  </label><br />

  <label>
    Typ:
    <input formControlName="typ" />
    @if (form.controls.typ.invalid && form.controls.typ.touched) {
      <span>Typ ist erforderlich.</span>
    }
  </label><br />

  <label>
    Beschreibung:
    <input formControlName="beschreibung" />
    @if (form.controls.beschreibung.invalid && form.controls.beschreibung.touched) {
      <span>Beschreibung ist erforderlich.</span>
    }
  </label><br />

  <label>
    Betrag netto:
    <input type="number" formControlName="betragnetto" step="0.01" />
    @if (form.controls.betragnetto.invalid && form.controls.betragnetto.touched) {
      <span>Bitte einen positiven Betrag eingeben.</span>
    }
  </label><br />

  <label>
    Partner:
    <select formControlName="partnerid">
      <option value="">Bitte wählen</option>
      @for (p of partners$ | async; track p.id) {
        <option [value]="p.id">{{ p.name }}</option>
      }
    </select>
    @if (form.controls.partnerid.invalid && form.controls.partnerid.touched) {
      <span>Partner ist erforderlich.</span>
    }
  </label><br />

  <label>
    Kategorie:
    <select formControlName="kategorieid">
      <option value="">Bitte wählen</option>
      @for (k of kategorien$ | async; track k.id) {
        <option [value]="k.id">{{ k.kategorie }}</option>
      }
    </select>
    @if (form.controls.kategorieid.invalid && form.controls.kategorieid.touched) {
      <span>Kategorie ist erforderlich.</span>
    }
  </label><br />

  <label>
    Kostenstelle:
    <select formControlName="kostenstelleid">
      <option value="">Bitte wählen</option>
      @for (ks of kostenstellen$ | async; track ks.id) {
        <option [value]="ks.id">{{ ks.kostenstelle }}</option>
      }
    </select>
    @if (form.controls.kostenstelleid.invalid && form.controls.kostenstelleid.touched) {
      <span>Kostenstelle ist erforderlich.</span>
    }
  </label><br />

  <label>
    Steuersatz:
    <select formControlName="steuersatzid">
      <option value="">Bitte wählen</option>
      @for (st of steuersaetze$ | async; track st.id) {
        <option [value]="st.id">{{ st.bezeichnung }} ({{ st.prozentsatz }}%)</option>
      }
    </select>
    @if (form.controls.steuersatzid.invalid && form.controls.steuersatzid.touched) {
      <span>Steuersatz ist erforderlich.</span>
    }
  </label><br />

  <label>
    Gesperrt:
    <input type="checkbox" [checked]="form.value.locked" disabled />
  </label><br />

  <button type="submit" [disabled]="form.invalid || form.value.locked">Speichern</button>
  <button type="button" (click)="form.reset()">Abbrechen</button>

</form>