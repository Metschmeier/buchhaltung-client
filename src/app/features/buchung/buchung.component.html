<h2>Alle Buchungen</h2>
<button mat-raised-button color="primary" (click)="exportCsv()">üì• Als CSV exportieren</button>

<table mat-table [dataSource]="dataSource" matSort class="mat-elevation-z8 full-width-table">

  <!-- Datum -->
  <ng-container matColumnDef="datum">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Datum</th>
    <td mat-cell *matCellDef="let b">{{ b.datum | date }}</td>
  </ng-container>

  <!-- Typ -->
  <ng-container matColumnDef="typ">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Typ</th>
    <td mat-cell *matCellDef="let b">{{ b.typ }}</td>
  </ng-container>

  <!-- Beschreibung -->
  <ng-container matColumnDef="beschreibung">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Beschreibung</th>
    <td mat-cell *matCellDef="let b">{{ b.beschreibung }}</td>
  </ng-container>

  <!-- Betrag Netto -->
  <ng-container matColumnDef="betragNetto">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Betrag Netto</th>
    <td mat-cell *matCellDef="let b">{{ b.betragNetto | currency:'EUR':'symbol':'1.2-2' }}</td>
  </ng-container>

  <!-- Partner -->
  <ng-container matColumnDef="partner">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Partner</th>
    <td mat-cell *matCellDef="let b">{{ getPartnerName(b.partnerId) }}</td>
  </ng-container>

  <!-- Kategorie -->
  <ng-container matColumnDef="kategorie">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Kategorie</th>
    <td mat-cell *matCellDef="let b">{{ getKategorieName(b.kategorieId) }}</td>
  </ng-container>

  <!-- Kostenstelle -->
  <ng-container matColumnDef="kostenstelle">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Kostenstelle</th>
    <td mat-cell *matCellDef="let b">{{ getKostenstelleName(b.kostenstelleId) }}</td>
  </ng-container>

  <!-- Steuersatz -->
  <ng-container matColumnDef="steuersatz">
    <th mat-header-cell *matHeaderCellDef mat-sort-header>Steuersatz</th>
    <td mat-cell *matCellDef="let b">{{ getSteuersatzBezeichnung(b.steuersatzId) }}</td>
  </ng-container>

  <!-- Aktionen -->
  <ng-container matColumnDef="aktionen">
    <th mat-header-cell *matHeaderCellDef>Aktionen</th>
    <td mat-cell *matCellDef="let b">
      <button mat-icon-button color="primary" (click)="editBuchung(b)">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button color="warn" (click)="deleteBuchung(b.id)" [disabled]="b.locked">
        <mat-icon>delete</mat-icon>
      </button>
    </td>
  </ng-container>

  <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
  <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
</table>

<mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons></mat-paginator>

<hr />

<form [formGroup]="form" (ngSubmit)="saveBuchung()" class="buchung-form">
  <label>
    Datum:
    <input type="date" formControlName="datum" required />
  </label><br />
  <label>
    Typ:
    <input type="text" formControlName="typ" required />
  </label><br />
  <label>
    Beschreibung:
    <input type="text" formControlName="beschreibung" required />
  </label><br />
  <label>
    Betrag Netto:
    <input type="number" formControlName="betragNetto" min="0.01" step="0.01" required />
  </label><br />
  <label>
    Partner:
    <select formControlName="partnerId" required>
      <option [value]="null" disabled>Bitte w√§hlen</option>
      <option *ngFor="let p of partners()" [value]="p.id">{{ p.name }}</option>
    </select>
  </label><br />
  <label>
    Kategorie:
    <select formControlName="kategorieId" required>
      <option [value]="null" disabled>Bitte w√§hlen</option>
      <option *ngFor="let k of kategorien()" [value]="k.id">{{ k.kategorie }}</option>
    </select>
  </label><br />
  <label>
    Kostenstelle:
    <select formControlName="kostenstelleId" required>
      <option [value]="null" disabled>Bitte w√§hlen</option>
      <option *ngFor="let ks of kostenstellen()" [value]="ks.id">{{ ks.kostenstelle }}</option>
    </select>
  </label><br />
  <label>
    Steuersatz:
    <select formControlName="steuersatzId" required>
      <option [value]="null" disabled>Bitte w√§hlen</option>
      <option *ngFor="let s of steuersaetze()" [value]="s.id">{{ s.bezeichnung }} ({{ s.prozentsatz }}%)</option>
    </select>
  </label><br />

  <button mat-raised-button color="primary" type="submit" [disabled]="form.invalid">Speichern</button>
  <button mat-stroked-button type="button" (click)="form.reset()">Abbrechen</button>
</form>
